import{G as k,r as s,j as e,i as q,a as G,b as H,c as K,o as Q}from"../chunks/chunk-BXwhWm2f.js";import{u as X}from"../chunks/chunk-C-Yr1VuT.js";import"../chunks/chunk-BkCfDSPM.js";/* empty css                      */async function Y(l){await L({action:"createWord",payload:l})}async function Z(l){await L({action:"createVideo",payload:l})}async function ee(l){const d=await l.file.arrayBuffer(),f=Array.from(new Uint8Array(d)),p={action:"uploadVideoFile",payload:{name:l.file.name,mimeType:l.file.type||"application/octet-stream",content:f,wordId:l.wordId,type:l.type,videoId:l.videoId}},x=await(await fetch(k,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(p)})).text();let i;try{i=x?JSON.parse(x):void 0}catch{throw new Error(`영상 파일 업로드 응답 파싱 실패: ${x}`)}if(i&&typeof i=="object"&&"error"in i&&i.error)throw new Error(`영상 파일 업로드 오류: ${i.error}`);if(!i||typeof i!="object"||!("videoUrl"in i))throw new Error(`영상 파일 업로드 응답에 videoUrl이 없습니다: ${x}`);const c=i;if(!c.videoUrl)throw new Error(`영상 파일 업로드 응답에 videoUrl이 없습니다: ${x}`);return{videoUrl:c.videoUrl,fileId:c.fileId,createdAt:c.createdAt}}async function L(l){const d=await fetch(k,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(l)});if(!d.ok)throw new Error(`Apps Script 호출 실패 (${d.status})`);const f=await d.text();if(f)try{const p=JSON.parse(f);if(p&&typeof p=="object"&&"error"in p&&p.error)throw new Error(String(p.error));return p}catch{return}}function V(l){const d=Date.now().toString(36);return`${l}${d}`}function te(){const{entries:l,errorMessage:d}=X(),[f,p]=s.useState(l),[w,x]=s.useState(""),[i,c]=s.useState({word:"",wordType:"",meaning:"",tags:"",level:"",notes:""}),[P,E]=s.useState(!1),[b,j]=s.useState(""),[n,u]=s.useState({wordId:"",type:"word",sentenceText:"",videoUrl:"",description:"",signer:"",tags:""}),[z,I]=s.useState(!1),[T,v]=s.useState(""),[y,A]=s.useState(null),[D,U]=s.useState(null),[C,m]=s.useState(0),[g,h]=s.useState(0),S=s.useRef(null);s.useEffect(()=>{if(!y){U(null);return}const t=URL.createObjectURL(y);return U(t),()=>{URL.revokeObjectURL(t)}},[y]);const O=s.useMemo(()=>{const t=w.trim().toLowerCase();return t?f.filter(r=>[r.word,r.meaning||"",r.wordId].join(" ").toLowerCase().includes(t)):f},[f,w]);async function _(t){if(t.preventDefault(),!i.word.trim()){j("단어를 입력하세요.");return}E(!0),j("");const r=V("W");try{await Y({wordId:r,word:i.word.trim(),wordType:i.wordType.trim()||void 0,meaning:i.meaning.trim()||void 0,tags:i.tags.trim()||void 0,level:i.level.trim()||void 0,notes:i.notes.trim()||void 0});const o=i.tags.trim().length===0?[]:i.tags.split(/[;,]/).map(a=>a.trim()).filter(a=>a.length>0);p(a=>[...a,{wordId:r,word:i.word.trim(),wordType:i.wordType.trim()||void 0,meaning:i.meaning.trim()||void 0,tags:o,level:i.level.trim()||void 0,notes:i.notes.trim()||void 0,wordVideos:[],sentenceVideos:[]}]),u(a=>({...a,wordId:r})),j(`단어가 추가되었습니다. word_id: ${r}. 잠시 후 새로고침하면 목록에 반영됩니다.`),c({word:"",wordType:"",meaning:"",tags:"",level:"",notes:""})}catch(o){const a=o instanceof Error?o.message:String(o);j(`오류가 발생했습니다: ${a}`)}finally{E(!1)}}async function F(t){if(t.preventDefault(),!n.wordId){v("연결할 단어를 선택하세요.");return}if(!n.videoUrl.trim()&&!y){v("영상 링크를 입력하거나 로컬 파일을 선택하세요.");return}I(!0),v("");const r=V("V");try{let o=n.videoUrl.trim(),a;if(!o&&y){const R=await ee({file:y,wordId:n.wordId,type:n.type==="sentence"?"sentence":"word",videoId:r});o=R.videoUrl,a=R.createdAt}if(!o)throw new Error("영상 링크를 생성하지 못했습니다.");await Z({videoId:r,type:n.type==="sentence"?"sentence":"word",wordId:n.wordId,sentenceText:n.sentenceText.trim()||void 0,videoUrl:o,description:n.description.trim()||void 0,signer:n.signer.trim()||void 0,tags:n.tags.trim()||void 0,createdAt:a}),v(`영상이 추가되었습니다. video_id: ${r}. 잠시 후 새로고침하면 목록에 반영됩니다.`),u({wordId:n.wordId,type:n.type,sentenceText:"",videoUrl:"",description:"",signer:"",tags:""}),A(null),U(null),m(0),h(0)}catch(o){const a=o instanceof Error?o.message:String(o);v(`오류가 발생했습니다: ${a}`)}finally{I(!1)}}function M(t){const r=t.target.files&&t.target.files[0]?t.target.files[0]:null;A(r),r||(m(0),h(0))}function W(t){const r=t.currentTarget;!g&&r.duration&&Number.isFinite(r.duration)&&h(r.duration)}function $(t){const r=t.currentTarget;g>0&&r.currentTime>=g&&r.pause()}function N(){const t=S.current;if(!t)return;const r=t.currentTime||0;if(m(r),!g||g<r){const o=t.duration||r;h(o)}}function B(){const t=S.current;if(!t)return;const r=t.currentTime||0;r<=C&&m(0),h(r)}function J(){const t=S.current;if(!t||!D)return;const r=t.duration||0,o=Math.max(0,Math.min(C,r));let a=g;(!a||a<=o||a>r)&&(a=r),r&&(a<=o||((t.currentTime<o||t.currentTime>a)&&(t.currentTime=o),t.play()))}return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{children:[e.jsx("h1",{children:"단어·영상 추가"}),e.jsx("p",{style:{fontSize:14,color:"#555"},children:"구글시트와 연결된 단어와 영상을 이 화면에서 추가할 수 있습니다."})]}),d&&e.jsxs("div",{style:{padding:10,borderRadius:6,backgroundColor:"#fff3cd",border:"1px solid #ffeeba",fontSize:13,color:"#856404"},children:["기존 단어 목록을 불러오는 중 오류가 발생했습니다. 시트 탭 이름과 공유 설정을 확인하세요.",e.jsx("br",{}),"상세 메시지: ",d]}),e.jsxs("section",{style:{border:"1px solid #eee",borderRadius:8,padding:16,display:"flex",flexDirection:"column",gap:12},children:[e.jsx("h2",{children:"새 단어 추가"}),e.jsxs("form",{onSubmit:_,style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"단어"}),e.jsx("input",{type:"text",value:i.word,onChange:t=>c(r=>({...r,word:t.target.value})),required:!0})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"모양"}),e.jsx("input",{type:"text",value:i.wordType,onChange:t=>c(r=>({...r,wordType:t.target.value}))})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"뜻"}),e.jsx("input",{type:"text",value:i.meaning,onChange:t=>c(r=>({...r,meaning:t.target.value}))})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"태그 (쉼표로 구분)"}),e.jsx("input",{type:"text",value:i.tags,onChange:t=>c(r=>({...r,tags:t.target.value})),placeholder:"예: 교육, 장소"})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"난이도"}),e.jsx("input",{type:"text",value:i.level,onChange:t=>c(r=>({...r,level:t.target.value})),placeholder:"예: 초급, 중급, 고급"})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"메모"}),e.jsx("textarea",{value:i.notes,onChange:t=>c(r=>({...r,notes:t.target.value})),rows:3})]}),e.jsx("button",{type:"submit",disabled:P,style:{marginTop:8,padding:"8px 12px",borderRadius:4,border:"1px solid #1976d2",backgroundColor:"#1976d2",color:"white",cursor:"pointer"},children:P?"저장 중...":"단어 추가"}),b&&e.jsx("div",{style:{marginTop:6,fontSize:13,color:b.startsWith("오류")?"red":"#1976d2",wordBreak:"break-all"},children:b})]})]}),e.jsxs("section",{style:{border:"1px solid #eee",borderRadius:8,padding:16,display:"flex",flexDirection:"column",gap:12},children:[e.jsx("h2",{children:"새 영상 추가"}),e.jsxs("form",{onSubmit:F,style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"단어 검색"}),e.jsx("input",{type:"text",value:w,onChange:t=>x(t.target.value),placeholder:"단어, 뜻, ID로 검색"})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"연결할 단어"}),e.jsxs("select",{value:n.wordId,onChange:t=>u(r=>({...r,wordId:t.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"단어 선택"}),O.map(t=>e.jsxs("option",{value:t.wordId,children:[t.word," (",t.wordId,")"]},t.wordId))]})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"영상 유형"}),e.jsxs("select",{value:n.type,onChange:t=>u(r=>({...r,type:t.target.value})),children:[e.jsx("option",{value:"word",children:"단어 수어 영상"}),e.jsx("option",{value:"sentence",children:"문장 예제 영상"})]})]}),n.type==="sentence"&&e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"문장 텍스트"}),e.jsx("textarea",{value:n.sentenceText,onChange:t=>u(r=>({...r,sentenceText:t.target.value})),rows:2})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"영상 링크 (구글드라이브 공유 링크)"}),e.jsx("input",{type:"url",value:n.videoUrl,onChange:t=>u(r=>({...r,videoUrl:t.target.value})),placeholder:"직접 입력하거나 아래에서 파일을 선택하세요",required:!y})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"로컬 파일 선택 (미리보기)"}),e.jsx("input",{type:"file",accept:"video/*",onChange:M})]}),D&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("video",{ref:S,src:D,controls:!0,style:{width:"100%",maxHeight:300,backgroundColor:"black"},onLoadedMetadata:W,onTimeUpdate:$}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginTop:4},children:[e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:2,flex:1},children:[e.jsx("span",{children:"시작 시간 (초)"}),e.jsx("input",{type:"number",min:0,step:.1,value:C,onChange:t=>m(Number(t.target.value)||0)})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:2,flex:1},children:[e.jsx("span",{children:"끝 시간 (초)"}),e.jsx("input",{type:"number",min:0,step:.1,value:g,onChange:t=>h(Number(t.target.value)||0)})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:4},children:[e.jsx("button",{type:"button",onClick:N,style:{padding:"4px 8px",borderRadius:4,border:"1px solid #ccc",cursor:"pointer",fontSize:12},children:"현재 시간을 시작으로"}),e.jsx("button",{type:"button",onClick:B,style:{padding:"4px 8px",borderRadius:4,border:"1px solid #ccc",cursor:"pointer",fontSize:12},children:"현재 시간을 끝으로"}),e.jsx("button",{type:"button",onClick:J,style:{padding:"4px 8px",borderRadius:4,border:"1px solid #1976d2",backgroundColor:"#1976d2",color:"white",cursor:"pointer",fontSize:12,marginLeft:"auto"},children:"구간 재생"})]})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"설명"}),e.jsx("input",{type:"text",value:n.description,onChange:t=>u(r=>({...r,description:t.target.value})),placeholder:"예: 기본 속도, 느린 버전 등"})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"수어자"}),e.jsx("input",{type:"text",value:n.signer,onChange:t=>u(r=>({...r,signer:t.target.value}))})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("span",{children:"태그 (쉼표로 구분)"}),e.jsx("input",{type:"text",value:n.tags,onChange:t=>u(r=>({...r,tags:t.target.value}))})]}),e.jsx("button",{type:"submit",disabled:z,style:{marginTop:8,padding:"8px 12px",borderRadius:4,border:"1px solid #1976d2",backgroundColor:"#1976d2",color:"white",cursor:"pointer"},children:z?"저장 중...":"영상 추가"}),T&&e.jsx("div",{style:{marginTop:6,fontSize:13,color:T.startsWith("오류")?"red":"#1976d2"},children:T})]})]})]})}const re=Object.freeze(Object.defineProperty({__proto__:null,default:te},Symbol.toStringTag,{value:"Module"})),le={hasServerOnlyHook:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:{server:!0}}},guardEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:Q}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:K}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:H}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/admin/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:re}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/pages/+Layout.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"plus-file",exportValues:G}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","title"]},valueSerialized:{type:"js-serialized",value:"My Vike App"}},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:q}}};export{le as configValuesSerialized};
